. ~/venv/bin/activate
python -c "
import duckdb
con = duckdb.connect('kth_metadata.duckdb')

con.execute(\"\"\"
CREATE TABLE IF NOT EXISTS author_orcid_candidates AS
SELECT
  a.pid                         AS pid,
  p.Title                       AS pub_title,
  p.Year                        AS pub_year,
  p.PublicationType             AS pub_type,
  p.ContentType                 AS content_type,

  -- author identification
  a.author_id                   AS kth_author_id,   -- 'u1...' when present
  a.author_given                AS given_name,
  a.author_family               AS family_name,
  a.author_role                 AS author_role,
  a.orcid                       AS orcid,

  -- orgs / affiliations
  a.org_id                      AS org_id,
  a.affiliation                 AS affiliation_free,
  a.affiliations                AS affiliations_full,
  a.affs                        AS affs_array,      -- parsed KTH org path

  -- subjects
  hsv.hsv_eng                   AS hsv_code,
  st.topic                      AS subject_topic

FROM authorships a
LEFT JOIN pub p
  ON p.PID = a.pid
LEFT JOIN topic_code_hsv hsv
  ON hsv.pid = a.pid
LEFT JOIN subject_topic st
  ON st.pid = a.pid
\"\"\")

print(con.execute('SELECT * FROM author_orcid_candidates LIMIT 5').fetchall())
"
